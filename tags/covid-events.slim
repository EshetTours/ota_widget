---
---
covid-events.mdc-image-list__item
  .chart.block.mdc-elevation--z1 if='{d.events}'
    .material-icons.info
      'info
    h2
      '{t('covid_events.title')}

    #covid_events-chart style="width: 100%; height: 500px;"

    .mentions-row
      .mention each='{m in scoreMentions}'
        .mention-meta
          .topic
            strong
              '{t('opinions.topics.'+m.topic, {default: m.label})}
        .mention-score class='{w.mentions.scoreClass(m)}'
          '{w.mentions.scoreLabel(m)}

      .mention if='{covid}'
        .mention-meta
          .topic
            strong
              '{t('opinions.topics.'+covid.topic, {default: covid.label})}
          .times
            '{covid.opinions_count} {t('mentions.times')}

  javascript:
    ota_widget.ui.tagClass.bind(this)()
    this.period      = 'quarter'
    this.scoreTopics = ['sanitary_safety', 'health_precautions']

    load() {
      this.mentions      = _.keyBy(this.d.mentions, 'topic')
      this.scoreMentions = _.values(_.pick(this.mentions, this.scoreTopics))
      this.covid         = this.mentions.covid

      tippy('covid-events .material-icons.info', {
        content: this.t('covid_events.description'),
      })

      this.w.charts.draw(this)
    }

    data() {
      var data = this.d.events
      if (!data) return

      delete data.continents.antarctica
      var series = _.keys(data.continents)
      return {
        id:         'covid_events-chart',
        header:     [''].concat(ota_widget.charts.t(series)),
        series:     series,
        data:       data.continents,
        chartClass: google.visualization.LineChart
      }
    }

    this.on('mount',  this.load)
    this.on('update', this.load)

